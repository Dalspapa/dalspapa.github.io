# ARP
---

> 주소 결정 프로토콜(Address Resolution Protocol, ARP)은 네트워크 상에서 IP 주소를 물리적 네트워크 주소로 대응(bind)시키기 위해 사용되는 프로토콜이다. 여기서 물리적 네트워크 주소는 이더넷 또는 토큰링의 48 비트 네트워크 카드(NIC) 주소를 뜻한다. 

<br/>

## 🤷‍♂️ 주소 결정 프로토콜 
---

- IP 주소를 MAC 주소와 매칭 시키기 위한 프로토콜.
- 로컬 네트워크(LAN, Local Area Network)에서 단말과 단말 간 통신을 하기 위해서는 IP 주소와 함께 MAC 주소를 이용. 
- IP 주소를 MAC Address와 매칭해야 목적지 IP의 단말이 소유한 MAC 주소를 향해 제대로 찾아감.

<br/>
<br/>

## 🏠 LAN(Local Address Network)
---

>근거리 통신망, 로컬 영역 네트워크(영어: local area network, LAN), 구내 정보 통신망은 네트워크 매체를 이용하여 집, 사무실, 학교 등의 건물과 같은 가까운 지역을 한데 묶는 컴퓨터 네트워크이다.

- 위키백과에서 서술한 LAN(Local Address Network)의 정의.
- 네트워크를 정의할 때는 IP 주소와 Subnetmask를 이용하여 정의하기 마련.
- *아무리 큰 규모의 네트워크일지라도 같은 IP 대역을 공유한다면 그것은 근거리 네트워크.*

### **📌 LAN = ARP Request가 미치는 영역**
- APR Request Packet이 전달되기만 한다면 LAN 이라고 봄.
- IP 주소와 MAC 주소를 매칭하기 위해 ARP가 사용.
  > 같은 IP 대역을 공유하는 LAN에서 단말간 통신을 하기 위해 ip / mac 매칭 
  > > Layer 2에서의 통신에서 사용자는 IP 주소를 목적지로 지정하지만 실제로는 MAC 주소를 이용해 목적지를 탬색한다.

<br/>
<br/>

## 📜 MAC Address
---

*데이터 링크 계층에서 통신을 위한 네트워크 인터페이스에 할당된 고유 식별자*
 
 - Network Interface Card(NIC)를 가진 단말이라면 공장에서 출고될 때 부여.
 - Network Interface Card마다 MAC 주소를 갖고 있음.
 - 평생 사용하는 고유한 주소.
 - 즉 LAN(Local Address Network)에서 목적지와 통신하기 위한 실질적인 주소. 
 - LAN(Local Address Network, Layer 2)에서는 IP 주소를 MAC 주소에 매칭하여 통신.

<br/>

## 🤷‍♀️ 왜 MAC 주소가 필요한가?
---

> 🤔 예시
> >
> 저는 대학생 시절 버스를 타고 학교와 집을 오고 갔습니다. 그리고 그 버스는 내비게이션이 아닌 도로 표지판을 보고 서울에서 성남으로 향했지요. 그 시절을 떠올리며 '서울특별시 광진구 화양동 43'에서 '성남시 분당구 야탑동 24'으로 간다고 생각해보겠습니다.
> >
> 화양동을 출발하여 남쪽으로 내려갑니다. 도로 표지판을 보니 성남으로 가기 위해서는 잠실대교를 건너 송파구의 석촌동, 문정동을 지나면 문정동 옆에 복정동으로 향하는 도로가 있다고 합니다. 그 길을 따라 갑니다. 성남시 수정구 복정동에 도착하니 도로 표지판에 분당구 야탑동으로 가려면 중원구 성남동을 지나가야 한다고 하네요. 성남동을 지나 드디어 야탑동에 도착했습니다! 그런데 말입니다... 야탑동 24가 어디죠...? 막상 야탑동에 도착하니 야탑동 24가 어디인지 써있는 도로 표지판이 없습니다.
> >
> 이런 경우 주변의 물리적인 지형지물을 통해 야탑동 24의 위치를 찾아낼 수 있습니다. 야탑동 24라는 곳이 친구 집이라면 친구에게 전화해 "한국전자부품연구원 위에 보면 야탑천이 시작되는 곳이 있는데 거기에 있어"라는 답변을 얻을 수 있을 겁니다. 
> >
> ***'야탑동 24'라는 행정적 주소는 제도에 따라 변할 수 있지만 '야탑천이 시작되는 곳'이라는 물리적인 주소는 결코 변하지 않습니다.*** 논리적 주소인 IP 주소와 물리적 주소인 MAC주소의 관계 또한 행정적 주소와 물리적 주소와 맥이 같다고 볼 수 있습니다.

- IP 주소는 끊임없이 변화
- MAC 주소를 사용하여 전달하는 것이 확실
  
> 거꾸로 인터넷 상에서 IP 주소 없이 변화하지 않는 고유한 주소인 MAC 주소를 사용하여 라우팅을 한다면... 각 고유한 주소를 라우팅 테이블에 일일이 입력하다간 라우터가 다운될 수 있다. 
> > 숫자가 매우 많아짐 
> 
> > IP 주소는 연속성을 갖기 때문에 IP 주소 다수를 한 줄로 지정해줄 수 있음)

<br/>
<br/>

## 🔥 그렇다면 ARP란 무엇인가?
---

단말간 통신에서 양쪽 단말은 IP를 이용하여 목적지를 지정하지만 실제 데이터 이동을 위해 **MAC 주소**를 함께 이용한다. 이를 위해 필요한 것이 바로 **Address Resolution Protocol(ARP)**이며 IP 주소와 MAC 주소를 일대일 매칭하여 LAN(Layer 2)에서 목적지를 제대로 찾아갈 수 있도록 돕는다. 

IP 주소와 MAC 주소를 일대일 대응하여 테이블로 정리하고 목적지 IP에 맞는 목적지 MAC 주소로 전달한다. 이것을 **ARP Table**이라 부른다. (IP 주소와 MAC 주소를 일대일 매칭시킨 정보를 정리해둔 Table을 뜻함.)

> 중간에서 데이터를 전달하는 스위치 또한 자신의 Port에 연결된 PC 들의 MAC 주소 정보를 갖고 있다. 
>> 어느 Port에서 어느 PC의 MAC 주소가 올라오는지 알아야 PC에게서 전달받은 데이터를 전달할 때 목적지 MAC 주소를 올바르게 지정할 수 있기 때문

<br/>
<br/>

## ARP Table 생성 과정
---

IP 주소와 MAC 주소가 구비되어있다 하더라도, 다른 PC의 IP 주소와 MAC 주소를 모르면 데이터를 전달할 수 없다. 그래서 ARP Table을 생성하여 다른 PC들에 대한 주소 정보를 확보하는 것이 필요하다.


![enter image description here](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/l4mjn/btqE9dmDWRb/C9oLJr9vZCq6pVarf74UHK/img.png)

*PC 0,1,2,3뿐만 아니라 모든 단말들은 자신만의 Routing Table이 있어 자신이 보내려는 패킷의 목적지 IP가 자신이 소속된 IP 대역인지 아닌지 알 수 있다.*

1. `PC 0(192.168.1.1)`는 `PC 2(192.168.1.3)`에게 데이터를 전달하려고 한다. (Routing table을 보니 `자신(PC 0)`과 `PC 2`가 같은 LAN에 속함.) 이 때 `PC 2`의 MAC 주소를 알기 위해 **ARP Request**(`Who has 192.168.1.3? Tell 192.168.1.1`) 를 뿌린다.

2. `PC 0`는 **Broadcast**(`FF:FF:FF:FF:FF:FF`)인 **ARP Request**를 날리고 이 것은 `PC 1, PC 2, PC 3`에 전달된다. 그리고 **ARP Request**의 목표인 `PC 2`가 이에 반응하여 **ARP Response**(`PC 2의 MAC 주소`)를 보낸다. 

3. `PC 0(192.168.1.1)`는 `PC 2`가 보낸 **ARP Reponse**를 받고 **ARP Table**에 `PC 2`의 IP와 MAC 주소를 적는다. 그리고 데이터를 보내려 목적지 IP를 `192.168.1.3`으로 지정하면 자연스레 **ARP Table**을 보고 `PC 2`의 MAC 주소를 목표로 전달한다.

***ARP는 이더넷 통신에 없어서는 안 될 매우 중요한 요소이며 네트워크 트러블 슈팅의 기본으로 잘 알고 있어야 한다.***